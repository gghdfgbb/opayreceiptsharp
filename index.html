<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OPay Receipt Generator</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .form-section {
            padding: 20px;
        }
        
        .preview-section {
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .title {
            color: #1A3A7A;
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            color: #555;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #00C389;
            box-shadow: 0 0 0 3px rgba(0, 195, 137, 0.1);
        }
        
        .amount-input {
            position: relative;
        }
        
        .amount-input::before {
            content: "‚Ç¶";
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            color: #00C389;
            font-weight: bold;
            z-index: 1;
        }
        
        .amount-input input {
            padding-left: 35px;
        }
        
        .helper-text {
            font-size: 0.9rem;
            color: #888;
            margin-top: 5px;
            font-style: italic;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-generate {
            background: linear-gradient(135deg, #00C389 0%, #00a371 100%);
            color: white;
        }
        
        .btn-download {
            background: linear-gradient(135deg, #1A3A7A 0%, #0d285c 100%);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .receipt-container {
            position: sticky;
            top: 30px;
        }
        
        .instructions {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .instructions h3 {
            color: #1A3A7A;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
            color: #666;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        #receiptPreview {
            width: 320px;
            background: #f0f2f5;
            padding: 20px;
            border-radius: 10px;
            min-height: 500px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .preview-section {
                order: -1;
            }
            
            #receiptPreview {
                width: 100%;
                max-width: 320px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="form-section">
            <h1 class="title">OPay Receipt Generator</h1>
            
            <form id="receiptForm">
                <div class="form-group">
                    <label for="senderName">Your Name (Sender)</label>
                    <input type="text" id="senderName" placeholder="Enter your full name" required>
                </div>
                
                <div class="form-group">
                    <label for="senderAccount">Your Account Number</label>
                    <input type="text" id="senderAccount" placeholder="Enter your 10-digit account number" 
                           pattern="[0-9]{10}" maxlength="10" required>
                    <div class="helper-text">Enter your 10-digit OPay account number</div>
                </div>
                
                <div class="form-group">
                    <label for="recipientName">Recipient Name</label>
                    <input type="text" id="recipientName" placeholder="Enter recipient's full name" required>
                </div>
                
                <div class="form-group">
                    <label for="recipientBank">Recipient Bank</label>
                    <select id="recipientBank" required>
                        <option value="">Select bank</option>
                        <option value="SmartCash Payment Service Bank">SmartCash Payment Service Bank</option>
                        <option value="Access Bank">Access Bank</option>
                        <option value="First Bank">First Bank</option>
                        <option value="GTBank">GTBank</option>
                        <option value="Zenith Bank">Zenith Bank</option>
                        <option value="UBA">UBA</option>
                        <option value="Fidelity Bank">Fidelity Bank</option>
                        <option value="OPay">OPay</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="recipientAccount">Recipient Account Number</label>
                    <input type="text" id="recipientAccount" placeholder="Enter recipient's account number" required>
                </div>
                
                <div class="form-group">
                    <label for="amount">Amount</label>
                    <div class="amount-input">
                        <input type="number" id="amount" placeholder="0.00" min="1" step="0.01" required>
                    </div>
                </div>
                
                <div class="buttons">
                    <button type="button" class="btn btn-generate" onclick="generateReceipt()">
                        <span>üîÑ</span> Generate Receipt
                    </button>
                    <button type="button" class="btn btn-download" onclick="downloadReceipt()">
                        <span>üì•</span> Download as Image
                    </button>
                </div>
            </form>
            
            <div class="instructions">
                <h3>How to Use:</h3>
                <ul>
                    <li>Fill in all the details in the form</li>
                    <li>Click "Generate Receipt" to preview</li>
                    <li>Click "Download as Image" to save the receipt</li>
                    <li>Your account number will be masked (first 3 and last 3 digits shown)</li>
                    <li>Transaction number and time are automatically generated</li>
                </ul>
            </div>
        </div>
        
        <div class="preview-section">
            <h2 style="color: #1A3A7A; margin-bottom: 20px;">Preview</h2>
            <div id="receiptPreview">
                <div style="text-align: center; color: #666; padding: 40px;">
                    <div style="font-size: 48px; margin-bottom: 20px;">üìÑ</div>
                    <p>Your receipt will appear here after generation</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Format account number to show first 3 and last 3 digits
        function formatAccountNumber(account) {
            if (account.length >= 6) {
                const firstThree = account.substring(0, 3);
                const lastThree = account.substring(account.length - 3);
                const stars = '*'.repeat(account.length - 6);
                return firstThree + stars + lastThree;
            }
            return account;
        }
        
        // Format amount with commas
        function formatAmount(amount) {
            return parseFloat(amount).toLocaleString('en-NG', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }
        
        // Generate transaction number
        function generateTransactionNumber() {
            const date = new Date();
            const year = date.getFullYear().toString().substr(-2);
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const seconds = date.getSeconds().toString().padStart(2, '0');
            const random = Math.floor(Math.random() * 1000000).toString().padStart(6, '0');
            return `${year}${month}${day}${hours}${minutes}${seconds}${random}`;
        }
        
        // Format date in Nigerian format
        function formatNigeriaDate(date) {
            const months = [
                'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'
            ];
            
            const day = date.getDate();
            const month = months[date.getMonth()];
            const year = date.getFullYear();
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const seconds = date.getSeconds().toString().padStart(2, '0');
            
            // Add ordinal suffix to day
            const suffix = (day % 10 === 1 && day !== 11) ? 'st' :
                          (day % 10 === 2 && day !== 12) ? 'nd' :
                          (day % 10 === 3 && day !== 13) ? 'rd' : 'th';
            
            return `${month} ${day}${suffix}, ${year} ${hours}:${minutes}:${seconds}`;
        }
        
        // Generate receipt HTML
        function generateReceipt() {
            const senderName = document.getElementById('senderName').value;
            const senderAccount = document.getElementById('senderAccount').value;
            const recipientName = document.getElementById('recipientName').value;
            const recipientBank = document.getElementById('recipientBank').value;
            const recipientAccount = document.getElementById('recipientAccount').value;
            const amount = document.getElementById('amount').value;
            
            if (!senderName || !senderAccount || !recipientName || !recipientBank || !recipientAccount || !amount) {
                alert('Please fill in all fields');
                return;
            }
            
            if (senderAccount.length !== 10 || !/^\d+$/.test(senderAccount)) {
                alert('Please enter a valid 10-digit account number');
                return;
            }
            
            const formattedAccount = formatAccountNumber(senderAccount);
            const formattedAmount = formatAmount(amount);
            const transactionNumber = generateTransactionNumber();
            const transactionDate = formatNigeriaDate(new Date());
            
            // Store data for download function
            window.receiptData = {
                senderName,
                formattedAccount,
                recipientName,
                recipientBank,
                recipientAccount,
                formattedAmount,
                transactionNumber,
                transactionDate
            };
            
            // Create receipt HTML structure with INLINE styles
            const receiptHTML = `
                <div class="receipt" style="max-width: 300px; background: white; padding: 15px; border-radius: 0; position: relative; overflow: hidden; font-family: 'Inter', sans-serif; margin: 0 auto;">
                    <!-- Watermarks -->
                    <div style="position: absolute; top: 8%; left: 10%; transform: rotate(-35deg); font-size: 14px; font-weight: 900; color: rgba(0, 0, 0, 0.08); z-index: 0; pointer-events: none;">Opay</div>
                    <div style="position: absolute; top: 8%; left: 40%; transform: rotate(-35deg); font-size: 12px; font-weight: 900; color: rgba(0, 0, 0, 0.08); z-index: 0; pointer-events: none;">Opay</div>
                    <div style="position: absolute; top: 8%; left: 70%; transform: rotate(-35deg); font-size: 10px; font-weight: 900; color: rgba(0, 0, 0, 0.07); z-index: 0; pointer-events: none;">Opay</div>
                    <div style="position: absolute; top: 25%; left: 5%; transform: rotate(-35deg); font-size: 16px; font-weight: 900; color: rgba(0, 0, 0, 0.07); z-index: 0; pointer-events: none;">Opay</div>
                    <div style="position: absolute; top: 25%; left: 35%; transform: rotate(-35deg); font-size: 11px; font-weight: 900; color: rgba(0, 0, 0, 0.08); z-index: 0; pointer-events: none;">Opay</div>
                    <div style="position: absolute; top: 25%; left: 65%; transform: rotate(-35deg); font-size: 13px; font-weight: 900; color: rgba(0, 0, 0, 0.07); z-index: 0; pointer-events: none;">Opay</div>
                    <div style="position: absolute; top: 25%; left: 95%; transform: rotate(-35deg); font-size: 9px; font-weight: 900; color: rgba(0, 0, 0, 0.08); z-index: 0; pointer-events: none;">Opay</div>
                    <div style="position: absolute; top: 42%; left: 15%; transform: rotate(-35deg); font-size: 15px; font-weight: 900; color: rgba(0, 0, 0, 0.07); z-index: 0; pointer-events: none;">Opay</div>
                    <div style="position: absolute; top: 42%; left: 45%; transform: rotate(-35deg); font-size: 12px; font-weight: 900; color: rgba(0, 0, 0, 0.07); z-index: 0; pointer-events: none;">Opay</div>
                    <div style="position: absolute; top: 42%; left: 75%; transform: rotate(-35deg); font-size: 14px; font-weight: 900; color: rgba(0, 0, 0, 0.08); z-index: 0; pointer-events: none;">Opay</div>
                    <div style="position: absolute; top: 59%; left: 5%; transform: rotate(-35deg); font-size: 16px; font-weight: 900; color: rgba(0, 0, 0, 0.09); z-index: 0; pointer-events: none;">Opay</div>
                    <div style="position: absolute; top: 59%; left: 35%; transform: rotate(-35deg); font-size: 14px; font-weight: 900; color: rgba(0, 0, 0, 0.09); z-index: 0; pointer-events: none;">Opay</div>
                    <div style="position: absolute; top: 59%; left: 65%; transform: rotate(-35deg); font-size: 12px; font-weight: 900; color: rgba(0, 0, 0, 0.08); z-index: 0; pointer-events: none;">Opay</div>
                    <div style="position: absolute; top: 59%; left: 95%; transform: rotate(-35deg); font-size: 13px; font-weight: 900; color: rgba(0, 0, 0, 0.08); z-index: 0; pointer-events: none;">Opay</div>
                    <div style="position: absolute; top: 76%; left: 15%; transform: rotate(-35deg); font-size: 15px; font-weight: 900; color: rgba(0, 0, 0, 0.09); z-index: 0; pointer-events: none;">Opay</div>
                    <div style="position: absolute; top: 76%; left: 45%; transform: rotate(-35deg); font-size: 17px; font-weight: 900; color: rgba(0, 0, 0, 0.09); z-index: 0; pointer-events: none;">Opay</div>
                    <div style="position: absolute; top: 76%; left: 75%; transform: rotate(-35deg); font-size: 13px; font-weight: 900; color: rgba(0, 0, 0, 0.08); z-index: 0; pointer-events: none;">Opay</div>
                    <div style="position: absolute; top: 93%; left: 25%; transform: rotate(-35deg); font-size: 15px; font-weight: 900; color: rgba(0, 0, 0, 0.09); z-index: 0; pointer-events: none;">Opay</div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; position: relative; z-index: 1;">
                        <div style="font-size: 26px; font-weight: 900; position: relative; display: flex; align-items: center;">
                            <div style="width: 14px; height: 14px; border: 5px solid #00C389; border-radius: 50%; position: relative; margin-right: 2px;">
                                <div style="position: absolute; top: 50%; left: -5px; width: 5px; height: 5px; background: white; transform: translateY(-50%);"></div>
                                <div style="position: absolute; top: 50%; left: -7px; transform: translateY(-50%); color: #1A3A7A; font-weight: 900; font-size: 18px;">-</div>
                            </div>
                            <span style="color: #1A3A7A; margin-left: 2px; font-weight: 900; font-size: 26px;">P…ëy</span>
                        </div>
                        <div style="font-size: 12px; font-weight: 500; color: #666666; text-align: right; margin-top: 8px;">Transaction Receipt</div>
                    </div>
                    
                    <div style="text-align: center; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 1px solid #E5E5E5; position: relative; z-index: 1;">
                        <div style="font-size: 20px; font-weight: 700; margin-bottom: 4px; color: #00C389;">
                            <span style="font-size: 18px; margin-right: 2px; color: #00C389;">‚Ç¶</span>${formattedAmount}
                        </div>
                        <div style="font-size: 14px; font-weight: 600; margin-bottom: 1px; color: #666666;">Successful</div>
                        <div style="font-size: 9px; color: #666666;">${transactionDate}</div>
                    </div>
                    
                    <div style="margin: 12px 0; display: flex; justify-content: space-between; position: relative; z-index: 1;">
                        <div style="font-weight: 600; color: #999999; font-size: 12px; width: 40%;">Recipient Details</div>
                        <div style="font-size: 12px; width: 55%; text-align: right;">
                            <div style="font-weight: 700; color: #000000; font-size: 12px;">${recipientName.toUpperCase()}</div>
                            <div style="font-weight: 400; color: #999999; font-size: 12px;">${recipientBank} |</div>
                            <div style="font-weight: 400; color: #999999; font-size: 12px;">${recipientAccount}</div>
                        </div>
                    </div>
                    
                    <div style="margin: 12px 0; display: flex; justify-content: space-between; position: relative; z-index: 1;">
                        <div style="font-weight: 600; color: #999999; font-size: 12px; width: 40%;">Sender Details</div>
                        <div style="font-size: 12px; width: 55%; text-align: right;">
                            <div style="font-weight: 700; color: #000000; font-size: 12px;">${senderName.toUpperCase()}</div>
                            <div style="font-weight: 400; color: #999999; font-size: 12px;">OPay | ${formattedAccount}</div>
                        </div>
                    </div>
                    
                    <div style="margin: 12px 0; display: flex; justify-content: space-between; position: relative; z-index: 1;">
                        <div style="font-weight: 600; color: #999999; font-size: 12px; width: 40%;">Transaction No.</div>
                        <div style="font-weight: 400; color: #999999; font-size: 12px; width: 55%; text-align: right;">${transactionNumber}</div>
                    </div>
                    
                    <div style="text-align: left; font-size: 10px; color: #666666; line-height: 1.3; margin-top: 15px; padding-top: 12px; position: relative; z-index: 1;">
                        <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(135deg, transparent 25%, #E5E5E5 25%, #E5E5E5 50%, transparent 50%, transparent 75%, #E5E5E5 75%); background-size: 8px 8px;"></div>
                        Enjoy a better life with OPay. Get free transfers, withdrawals, bill payments, instant loans, and good annual interest On your savings. OPay is licensed by the Central Bank of Nigeria and insured by the NDIC.
                    </div>
                </div>
            `;
            
            // Add to preview
            document.getElementById('receiptPreview').innerHTML = receiptHTML;
            
            // Store the receipt element globally
            window.currentReceiptElement = document.querySelector('#receiptPreview .receipt');
            
            alert('Receipt generated successfully! Click "Download as Image" to save it.');
        }
        
        // Download receipt as image
        async function downloadReceipt() {
            const receiptElement = document.querySelector('#receiptPreview .receipt');
            
            if (!receiptElement) {
                alert('Please generate a receipt first');
                return;
            }
            
            try {
                // Show loading message
                const originalButton = document.querySelector('.btn-download');
                const originalText = originalButton.innerHTML;
                originalButton.innerHTML = '<span>‚è≥</span> Generating Image...';
                originalButton.disabled = true;
                
                // Create a hidden clone for better rendering
                const clone = receiptElement.cloneNode(true);
                clone.style.position = 'absolute';
                clone.style.left = '-9999px';
                clone.style.top = '0';
                clone.style.transform = 'none';
                clone.style.margin = '0';
                document.body.appendChild(clone);
                
                // Add font styles to clone
                const style = document.createElement('style');
                style.innerHTML = `
                    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
                `;
                clone.appendChild(style);
                
                // Wait a moment for rendering
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // Create canvas with higher quality
                const canvas = await html2canvas(clone, {
                    scale: 3, // Higher scale for better quality
                    backgroundColor: '#f0f2f5',
                    useCORS: true,
                    logging: false,
                    allowTaint: true,
                    width: clone.offsetWidth,
                    height: clone.offsetHeight,
                    onclone: function(clonedDoc, element) {
                        // Ensure fonts are loaded
                        const style = clonedDoc.createElement('style');
                        style.innerHTML = `
                            @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
                            * { 
                                font-family: 'Inter', sans-serif !important; 
                                -webkit-font-smoothing: antialiased;
                                -moz-osx-font-smoothing: grayscale;
                            }
                        `;
                        clonedDoc.head.appendChild(style);
                    }
                });
                
                // Create download link
                const link = document.createElement('a');
                link.download = `opay-receipt-${new Date().getTime()}.png`;
                link.href = canvas.toDataURL('image/png');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Clean up
                document.body.removeChild(clone);
                
                // Restore button
                originalButton.innerHTML = originalText;
                originalButton.disabled = false;
                
                alert('‚úÖ Receipt downloaded successfully!');
                
            } catch (error) {
                console.error('Error downloading receipt:', error);
                alert('‚ùå Error downloading receipt. Please try again.');
                
                // Restore button on error
                const originalButton = document.querySelector('.btn-download');
                originalButton.innerHTML = '<span>üì•</span> Download as Image';
                originalButton.disabled = false;
            }
        }
        
        // Auto-fill with sample data for testing
        function fillSampleData() {
            document.getElementById('senderName').value = 'PHILIP OTHUAMHO SALIU';
            document.getElementById('senderAccount').value = '9123456141';
            document.getElementById('recipientName').value = 'PHILIP SALIU';
            document.getElementById('recipientBank').value = 'SmartCash Payment Service Bank';
            document.getElementById('recipientAccount').value = '9013377147';
            document.getElementById('amount').value = '1000';
        }
        
        // Auto-fill sample data on page load (for testing)
        window.onload = function() {
            // Uncomment the line below to auto-fill sample data for testing
            // fillSampleData();
        };
    </script>
</body>
</html>
